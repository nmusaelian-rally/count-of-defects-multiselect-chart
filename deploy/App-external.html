<!DOCTYPE html>
<html>
<head>
    <title>Count of Defects, TTR</title>

    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.0/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",stateful:!0,getState:function(){return{tags:this.getTagRefsFromTagObjects(),filterByPriority:this.down("#priorityCheckbox").getValue()}},launch:function(){var widgetPanel=Ext.create("Ext.Panel",{itemId:"widget",layout:{type:"hbox",align:"middle"},items:[{xtype:"rallytagpicker",itemId:"tagPicker",stateful:!0,stateId:this.getContext().getScopedStateId("n-tags"),value:this.tags,listeners:{select:this.onTagsSelected,deselect:this.onTagsSelected,scope:this}},{xtype:"rallybutton",itemId:"applyTagFilter",text:"Apply Tag Filter",maxHeight:20,cls:"",margin:10,listeners:{click:this.filterByTags,scope:this}},{xtype:"container",title:"myTags",itemId:"myTags",border:1,flex:1},{xtype:"panel",itemId:"propertyPickerPanel",flex:1}]}),gridPanel=Ext.create("Ext.Panel",{itemId:"gridPanel",layout:{type:"hbox",align:"stretch"},items:[{xtype:"panel",title:"Grid Panel 1",itemId:"gridPanel1",flex:1},{xtype:"panel",title:"Grid Panel 2",itemId:"gridPanel2",flex:1}]}),chartPanel=Ext.create("Ext.Panel",{title:"Chart Panel",itemId:"chartPanel"});this.add(widgetPanel),this.add(gridPanel),this.add(chartPanel),this.down("#propertyPickerPanel").add({xtype:"rallycheckboxfield",boxLabel:"Filter grid by Priority",itemId:"priorityCheckbox",checked:this.filterByPriority,listeners:{change:this.onPrioirtyCheckboxChanged,scope:this}}),this.down("#propertyPickerPanel").add({xtype:"rallyfieldvaluecombobox",itemId:"priorityCombobox",model:"Defect",multiSelect:!0,defaultSelectionPosition:null,field:"Priority",stateful:!0,stateId:this.getContext().getScopedStateId("n-priority"),listeners:{select:this.getFilter,ready:this.getFilter,scope:this}})},getFilter:function(){var priorityBox=Ext.ComponentQuery.query("rallyfieldvaluecombobox[itemId=priorityCombobox]")[0];console.log("selected priorities:",priorityBox.getValue())},onTagsSelected:function(){this.tags=this.getTagRefsFromTagObjects(),this.saveState()},getTagRefsFromTagObjects:function(){var tagsRefs=[],tags=Ext.ComponentQuery.query("rallytagpicker[itemId=tagPicker]")[0]._getRecordValue();return console.log("_getRecordValue()...",tags),_.each(tags,function(tag){console.log(tag.data._ref),tagsRefs.push(tag.data._ref)}),console.log(tagsRefs),tagsRefs},filterByTags:function(){var selectedTagsList="Selected tags",tags=Ext.ComponentQuery.query("rallytagpicker[itemId=tagPicker]")[0]._getRecordValue(),container=Ext.ComponentQuery.query("container[itemId=myTags]")[0];_.each(tags,function(tag){selectedTagsList=selectedTagsList+"<br />"+tag.data._refObjectName,container.update(selectedTagsList)})},onPrioirtyCheckboxChanged:function(){this.filterByPriority=this.down("#priorityCheckbox").getValue(),this.saveState()}});

            Rally.launchApp('CustomApp', {
                name:"Count of Defects, TTR",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
